# ๐๏ธ **ุฏููู ูุงุนุฏุฉ ุงูุจูุงูุงุช - Juicetry Backend**

## ๐ **ุงููููุงุช ุงููุชููุฑุฉ:**

### **1. complete_backend_setup.sql**
**ุงูููู ุงูุฑุฆูุณู ูุฅุนุฏุงุฏ Backend ูุงูู**

**ุงููุญุชููุงุช:**
- โ ุฅูุดุงุก 9 ุฌุฏุงูู ุฑุฆูุณูุฉ
- โ ุชูุนูู Row Level Security (RLS)
- โ ุฅูุดุงุก Triggers ุชููุงุฆูุฉ
- โ ุฅูุดุงุก Functions ูุณุงุนุฏุฉ
- โ ุฅุฏุฑุงุฌ ุจูุงูุงุช ุชุฌุฑูุจูุฉ ุฃุณุงุณูุฉ
- โ ุฅุนุฏุงุฏ ุณูุงุณุงุช ุงูุฃูุงู

**ูุชู ุชุณุชุฎุฏูู:**
- ุนูุฏ ุฅุนุฏุงุฏ ุงููุดุฑูุน ูุฃูู ูุฑุฉ
- ุนูุฏ ุฅุนุงุฏุฉ ุจูุงุก ูุงุนุฏุฉ ุงูุจูุงูุงุช ูู ุงูุตูุฑ
- ุนูุฏ ููู ุงููุดุฑูุน ูุฎุงุฏู ุฌุฏูุฏ

**ููููุฉ ุงูุงุณุชุฎุฏุงู:**
```sql
-- ูู Supabase SQL Editor
-- ุงูุณุฎ ูู ุงููุญุชูู ูุงูุตูู ุซู Run
```

---

### **2. sample_data.sql**
**ุจูุงูุงุช ุชุฌุฑูุจูุฉ ุฅุถุงููุฉ**

**ุงููุญุชููุงุช:**
- โ ุชุตูููุงุช ุฅุถุงููุฉ (3 ุชุตูููุงุช)
- โ ููุชุฌุงุช ูุชููุนุฉ (15+ ููุชุฌ)
- โ ูุฑุงุฌุนุงุช ุนููุงุก (5 ูุฑุงุฌุนุงุช)
- โ ููุงูุงุช ูุฏููุฉ (2 ููุงูุงุช)
- โ ุฅุนุฏุงุฏุงุช ุตูุญุฉ ูู ูุญู

**ูุชู ุชุณุชุฎุฏูู:**
- ุจุนุฏ ุชูููุฐ complete_backend_setup.sql
- ุนูุฏ ุงูุญุงุฌุฉ ููุฒูุฏ ูู ุงูุจูุงูุงุช ุงูุชุฌุฑูุจูุฉ
- ูุงุฎุชุจุงุฑ ุงููุงุฌูุงุช ูุน ุจูุงูุงุช ูุงูุนูุฉ

**ููููุฉ ุงูุงุณุชุฎุฏุงู:**
```sql
-- ุจุนุฏ ุชูููุฐ complete_backend_setup.sql
-- ููุฐ ูุฐุง ุงูููู ูุฅุถุงูุฉ ุงููุฒูุฏ ูู ุงูุจูุงูุงุช
```

---

### **3. test_connection.sql**
**ุงุฎุชุจุงุฑ ุงูุงุชุตุงู ูุงูุชุญูู ูู ุงูุฅุนุฏุงุฏ**

**ุงููุญุชููุงุช:**
- โ ูุญุต ุงูุฌุฏุงูู ุงูููุฌูุฏุฉ
- โ ุนุฏ ุงูุณุฌูุงุช ูู ูู ุฌุฏูู
- โ ูุญุต ุณูุงุณุงุช RLS
- โ ูุญุต ุงูู Triggers
- โ ูุญุต ุงูู Functions
- โ ูุญุต ุงููุณุชุฎุฏููู ุงูุฅุฏุงุฑููู
- โ ูุญุต ุญุฌู ูุงุนุฏุฉ ุงูุจูุงูุงุช

**ูุชู ุชุณุชุฎุฏูู:**
- ุจุนุฏ ุฅุนุฏุงุฏ Backend ููุชุญูู ูู ูุฌุงุญ ุงูุฅุนุฏุงุฏ
- ุนูุฏ ููุงุฌูุฉ ูุดุงูู ูู ุงูุงุชุตุงู
- ููุญุตูู ุนูู ูุนูููุงุช ุนู ุญุงูุฉ ูุงุนุฏุฉ ุงูุจูุงูุงุช

**ููููุฉ ุงูุงุณุชุฎุฏุงู:**
```sql
-- ูู Supabase SQL Editor
-- ููุฐ ุงูุงุณุชุนูุงูุงุช ูุงุญุฏุงู ุชูู ุงูุขุฎุฑ
-- ุฃู ููุฐูุง ุฌููุนุงู ูุฑุฉ ูุงุญุฏุฉ
```

---

## ๐๏ธ **ูููู ูุงุนุฏุฉ ุงูุจูุงูุงุช:**

### **ุงูุฌุฏุงูู (9 ุฌุฏุงูู):**

```
๐ฆ categories
โโโ ูุนูููุงุช ุงูุชุตููู (ุงุณูุ ูุตูุ ุฃููููุฉุ ููู)
โโโ ุญุงูุฉ ุงูุชุตููู (ูุดุท/ุบูุฑ ูุดุท)
โโโ ุชุฑุชูุจ ุงูุนุฑุถ

๐ฆ products
โโโ ูุนูููุงุช ุงูููุชุฌ (ุงุณูุ ูุตูุ ุณุนุฑ)
โโโ ุงูุนูุงูุฉ ูุน ุงูุชุตููู
โโโ ุงูุตูุฑ (ุฑุฆูุณูุฉ + ุฅุถุงููุฉ)
โโโ ุงูููููุงุช ูุงููุนูููุงุช ุงูุบุฐุงุฆูุฉ
โโโ ุงูุฃุญุฌุงู ูุฎูุงุฑุงุช ุงูุชุฎุตูุต
โโโ ุญุงูุฉ ุงูููุชุฌ (ูุดุทุ ูููุฒุ ุฌุฏูุฏุ ุงูุฃูุซุฑ ูุจูุนุงู)
โโโ ุงููุฎุฒูู
โโโ ุงูุชููููุงุช (ูุชูุณุท + ุนุฏุฏ)
โโโ SEO (slug, meta)

๐ฆ orders
โโโ ูุนูููุงุช ุงูุนููู
โโโ ูุนูููุงุช ุงูุทูุจ (ูุจูุบุ ุฎุตูุ ุชูุตูู)
โโโ ุญุงูุฉ ุงูุทูุจ ูุงูุฏูุน
โโโ ูุนูููุงุช ุงูุชูุตูู
โโโ ุงูุชูุงุฑูุฎ ุงููููุฉ

๐ฆ order_items
โโโ ุงูุนูุงูุฉ ูุน ุงูุทูุจ ูุงูููุชุฌ
โโโ ูุนูููุงุช ุงูููุชุฌ ููุช ุงูุทูุจ
โโโ ุงููููุฉ ูุงูุฃุณุนุงุฑ
โโโ ุฎูุงุฑุงุช ุงูุชุฎุตูุต

๐ฆ customer_reviews
โโโ ุงูุนูุงูุฉ ูุน ุงูููุชุฌ ูุงูุทูุจ
โโโ ูุนูููุงุช ุงููุฑุงุฌุนุฉ (ุชููููุ ุชุนููู)
โโโ ุตูุฑ ุงููุฑุงุฌุนุฉ
โโโ ุญุงูุฉ ุงูููุงููุฉ ูุงูุชูุซูู
โโโ ุฑุฏ ุงูุฅุฏุงุฑุฉ

๐ฆ blog_posts
โโโ ุงููุญุชูู (ุนููุงูุ ูุตุ ุตูุฑ)
โโโ ุงูุชุตููู ูุงููุณูู
โโโ ูุนูููุงุช ุงููุงุชุจ
โโโ ุญุงูุฉ ุงููุดุฑ
โโโ ุงูุฅุญุตุงุฆูุงุช
โโโ SEO

๐ฆ profiles
โโโ ูุนูููุงุช ุงููุณุชุฎุฏู
โโโ ุงูุฏูุฑ ูุงูุตูุงุญูุงุช
โโโ ูุนูููุงุช ุฅุถุงููุฉ
โโโ ุฅุญุตุงุฆูุงุช

๐ฆ site_settings
โโโ ููุชุงุญ ุงูุฅุนุฏุงุฏ
โโโ ุงููููุฉ (JSONB)
โโโ ุงููุฆุฉ

๐ฆ about_page_settings
โโโ ููุชุงุญ ุงููุณู
โโโ ุงููุญุชูู (ุนุฑุจู + ุฅูุฌููุฒู)
โโโ ุงูุตูุฑุฉ
โโโ ุชุฑุชูุจ ุงูุนุฑุถ
```

---

## ๐ **ูุธุงู ุงูุฃูุงู (RLS):**

### **ุงููุณุชููุงุช:**

#### **1. ุนุงู (Public):**
```sql
โ ูุฑุงุกุฉ ุงูุชุตูููุงุช ุงููุดุทุฉ
โ ูุฑุงุกุฉ ุงูููุชุฌุงุช ุงููุดุทุฉ
โ ูุฑุงุกุฉ ุงููุฑุงุฌุนุงุช ุงูููุงูู ุนูููุง
โ ูุฑุงุกุฉ ุงูููุงูุงุช ุงูููุดูุฑุฉ
โ ูุฑุงุกุฉ ุงูุฅุนุฏุงุฏุงุช ุงูุนุงูุฉ
โ ุฅูุดุงุก ุทูุจุงุช ุฌุฏูุฏุฉ
โ ุฅุถุงูุฉ ูุฑุงุฌุนุงุช
```

#### **2. ุฅุฏุงุฑู (Admin/Manager):**
```sql
โ ูุฑุงุกุฉ ุฌููุน ุงูุจูุงูุงุช
โ ุฅุถุงูุฉ ุจูุงูุงุช ุฌุฏูุฏุฉ
โ ุชุนุฏูู ุงูุจูุงูุงุช ุงูููุฌูุฏุฉ
โ ุญุฐู ุงูุจูุงูุงุช
โ ุฅุฏุงุฑุฉ ุงููุณุชุฎุฏููู
โ ุชุบููุฑ ุงูุฅุนุฏุงุฏุงุช
```

#### **3. ููุธู (Staff):**
```sql
โ ูุฑุงุกุฉ ุงูุทูุจุงุช
โ ุชุญุฏูุซ ุญุงูุฉ ุงูุทูุจุงุช
โ ูุฑุงุกุฉ ุงููุฑุงุฌุนุงุช
โ ุงูุฑุฏ ุนูู ุงููุฑุงุฌุนุงุช
```

---

## โ๏ธ **ุงูู Triggers:**

### **1. update_updated_at_column()**
**ุงููุธููุฉ:** ุชุญุฏูุซ ุญูู `updated_at` ุชููุงุฆูุงู ุนูุฏ ุฃู ุชุนุฏูู

**ุงูุฌุฏุงูู ุงููุทุจูุฉ ุนูููุง:**
- categories
- products
- orders
- customer_reviews
- blog_posts
- profiles

**ูุซุงู:**
```sql
-- ุนูุฏ ุชุนุฏูู ููุชุฌ
UPDATE products SET price = 25.00 WHERE id = 1;
-- updated_at ูุชู ุชุญุฏูุซู ุชููุงุฆูุงู
```

---

### **2. update_product_rating()**
**ุงููุธููุฉ:** ุชุญุฏูุซ ุชูููู ุงูููุชุฌ ุชููุงุฆูุงู ุนูุฏ ุฅุถุงูุฉ/ุชุนุฏูู/ุญุฐู ูุฑุงุฌุนุฉ

**ููู ูุนูู:**
```sql
-- ุนูุฏ ุฅุถุงูุฉ ูุฑุงุฌุนุฉ ุฌุฏูุฏุฉ
INSERT INTO customer_reviews (product_id, rating, ...) VALUES (1, 5, ...);

-- ูุชู ุชููุงุฆูุงู:
-- 1. ุญุณุงุจ ูุชูุณุท ุงูุชููููุงุช
-- 2. ุชุญุฏูุซ products.rating
-- 3. ุชุญุฏูุซ products.reviews_count
```

---

### **3. generate_order_number()**
**ุงููุธููุฉ:** ุฅูุดุงุก ุฑูู ุทูุจ ูุฑูุฏ ุชููุงุฆูุงู

**ุงูุตูุบุฉ:** `ORD-YYYYMMDD-XXXXXX`

**ูุซุงู:**
```sql
-- ุนูุฏ ุฅูุดุงุก ุทูุจ
INSERT INTO orders (customer_name, ...) VALUES ('ุฃุญูุฏ', ...);

-- ูุชู ุฅูุดุงุก order_number ุชููุงุฆูุงู:
-- ORD-20241107-000001
```

---

### **4. generate_product_slug()**
**ุงููุธููุฉ:** ุฅูุดุงุก slug ููููุชุฌ ูู ุงุณูู

**ูุซุงู:**
```sql
-- ุนูุฏ ุฅุถุงูุฉ ููุชุฌ
INSERT INTO products (name, ...) VALUES ('ุนุตูุฑ ุจุฑุชูุงู ุทุงุฒุฌ', ...);

-- ูุชู ุฅูุดุงุก slug ุชููุงุฆูุงู:
-- ุนุตูุฑ-ุจุฑุชูุงู-ุทุงุฒุฌ-123
```

---

## ๐ง **ุงูุฏูุงู (Functions):**

### **1. is_admin()**
**ุงููุธููุฉ:** ุงูุชุญูู ูู ุตูุงุญูุงุช ุงูุฅุฏุงุฑุฉ

**ุงูุงุณุชุฎุฏุงู:**
```sql
SELECT is_admin();
-- ูุฑุฌุน true ุฅุฐุง ูุงู ุงููุณุชุฎุฏู admin ุฃู manager
```

---

### **2. calculate_order_total(order_id)**
**ุงููุธููุฉ:** ุญุณุงุจ ุฅุฌูุงูู ุงูุทูุจ

**ุงูุงุณุชุฎุฏุงู:**
```sql
SELECT calculate_order_total(1);
-- ูุฑุฌุน ูุฌููุน ุฃุณุนุงุฑ ุฌููุน ุนูุงุตุฑ ุงูุทูุจ
```

---

### **3. get_bestselling_products(limit)**
**ุงููุธููุฉ:** ุงูุญุตูู ุนูู ุงูููุชุฌุงุช ุงูุฃูุซุฑ ูุจูุนุงู

**ุงูุงุณุชุฎุฏุงู:**
```sql
SELECT * FROM get_bestselling_products(10);
-- ูุฑุฌุน ุฃูุถู 10 ููุชุฌุงุช ูุจูุนุงู
```

**ุงููุชูุฌุฉ:**
```
product_id | product_name | total_sold | total_revenue
-----------+--------------+------------+--------------
1          | ุนุตูุฑ ุจุฑุชูุงู  | 150        | 2250.00
2          | ุณููุซู ูุฑุงููุฉ | 120        | 2400.00
...
```

---

### **4. get_orders_statistics(start_date, end_date)**
**ุงููุธููุฉ:** ุงูุญุตูู ุนูู ุฅุญุตุงุฆูุงุช ุงูุทูุจุงุช

**ุงูุงุณุชุฎุฏุงู:**
```sql
SELECT * FROM get_orders_statistics(
  '2024-01-01'::timestamptz,
  '2024-12-31'::timestamptz
);
```

**ุงููุชูุฌุฉ:**
```
total_orders | total_revenue | average_order_value | pending_orders | completed_orders
-------------+---------------+---------------------+----------------+-----------------
250          | 15000.00      | 60.00               | 10             | 200
```

---

## ๐ **ุงุณุชุนูุงูุงุช ูููุฏุฉ:**

### **1. ุนุฑุถ ุงูููุชุฌุงุช ูุน ุชุตูููุงุชูุง:**
```sql
SELECT 
  p.id,
  p.name,
  p.price,
  c.name as category,
  p.rating,
  p.reviews_count,
  p.is_active,
  p.is_featured
FROM products p
LEFT JOIN categories c ON p.category_id = c.id
ORDER BY p.created_at DESC;
```

---

### **2. ุนุฑุถ ุงูุทูุจุงุช ูุน ุชูุงุตูููุง:**
```sql
SELECT 
  o.id,
  o.order_number,
  o.customer_name,
  o.customer_phone,
  o.final_amount,
  o.status,
  COUNT(oi.id) as items_count,
  STRING_AGG(oi.product_name, ', ') as products,
  o.created_at
FROM orders o
LEFT JOIN order_items oi ON o.id = oi.order_id
GROUP BY o.id
ORDER BY o.created_at DESC;
```

---

### **3. ุนุฑุถ ุงูููุชุฌุงุช ุงูุฃูุซุฑ ุชููููุงู:**
```sql
SELECT 
  id,
  name,
  price,
  rating,
  reviews_count
FROM products
WHERE is_active = true
  AND reviews_count > 0
ORDER BY rating DESC, reviews_count DESC
LIMIT 10;
```

---

### **4. ุฅุญุตุงุฆูุงุช ุงููุจูุนุงุช ุงูููููุฉ:**
```sql
SELECT 
  DATE(created_at) as date,
  COUNT(*) as orders_count,
  SUM(final_amount) as total_revenue,
  AVG(final_amount) as avg_order_value
FROM orders
WHERE status = 'delivered'
  AND created_at >= NOW() - INTERVAL '30 days'
GROUP BY DATE(created_at)
ORDER BY date DESC;
```

---

### **5. ุงูููุชุฌุงุช ุงูุชู ุชุญุชุงุฌ ูุฑุงุฌุนุฉ ุงููุฎุฒูู:**
```sql
SELECT 
  id,
  name,
  stock_quantity,
  CASE 
    WHEN stock_quantity = 0 THEN 'ููุฐ ุงููุฎุฒูู'
    WHEN stock_quantity < 10 THEN 'ูุฎุฒูู ููุฎูุถ'
    ELSE 'ูุชููุฑ'
  END as stock_status
FROM products
WHERE is_active = true
  AND stock_quantity < 10
ORDER BY stock_quantity ASC;
```

---

## ๐ **ุงูุตูุงูุฉ ุงูุฏูุฑูุฉ:**

### **1. ุชุญุฏูุซ ุงูุฅุญุตุงุฆูุงุช:**
```sql
-- ุชุญุฏูุซ ุชููููุงุช ุงูููุชุฌุงุช
UPDATE products p
SET 
  rating = (
    SELECT COALESCE(AVG(rating), 0)
    FROM customer_reviews
    WHERE product_id = p.id AND is_approved = true
  ),
  reviews_count = (
    SELECT COUNT(*)
    FROM customer_reviews
    WHERE product_id = p.id AND is_approved = true
  );
```

---

### **2. ุชูุธูู ุงูุจูุงูุงุช ุงููุฏููุฉ:**
```sql
-- ุญุฐู ุงูุทูุจุงุช ุงูููุบุงุฉ ุงููุฏููุฉ (ุฃูุซุฑ ูู 6 ุฃุดูุฑ)
DELETE FROM orders
WHERE status = 'cancelled'
  AND created_at < NOW() - INTERVAL '6 months';
```

---

### **3. ุชุญุณูู ุงูุฃุฏุงุก:**
```sql
-- ุฅุนุงุฏุฉ ุจูุงุก ุงูููุงุฑุณ
REINDEX TABLE products;
REINDEX TABLE orders;

-- ุชุญููู ุงูุฌุฏุงูู
ANALYZE products;
ANALYZE orders;
ANALYZE order_items;
```

---

## ๐ **ุงุณุชูุดุงู ุงูุฃุฎุทุงุก:**

### **ูุดููุฉ: ูุง ูููู ุฅุถุงูุฉ ุจูุงูุงุช**
```sql
-- ุชุญูู ูู ุณูุงุณุงุช RLS
SELECT * FROM pg_policies WHERE tablename = 'products';

-- ุชุญูู ูู ุตูุงุญูุงุช ุงููุณุชุฎุฏู
SELECT is_admin();

-- ุชุญูู ูู ูุฌูุฏ profile ูููุณุชุฎุฏู
SELECT * FROM profiles WHERE id = auth.uid();
```

---

### **ูุดููุฉ: ุงูุชููููุงุช ูุง ุชุชุญุฏุซ**
```sql
-- ุชุญูู ูู ูุฌูุฏ ุงูู trigger
SELECT * FROM information_schema.triggers
WHERE event_object_table = 'customer_reviews';

-- ุชุญุฏูุซ ูุฏูู
SELECT update_product_rating();
```

---

### **ูุดููุฉ: ุจุทุก ูู ุงูุงุณุชุนูุงูุงุช**
```sql
-- ุชุญูู ูู ุงูููุงุฑุณ
SELECT * FROM pg_indexes WHERE tablename = 'products';

-- ุชุญููู ุฎุทุฉ ุงูุชูููุฐ
EXPLAIN ANALYZE
SELECT * FROM products WHERE category_id = 1;
```

---

## ๐ **ููุงุญุธุงุช ูููุฉ:**

1. **ุงููุณุฎ ุงูุงุญุชูุงุทู:**
   - ูู ุจุนูู backup ุฏูุฑู ููุงุนุฏุฉ ุงูุจูุงูุงุช
   - ุงุณุชุฎุฏู Supabase Dashboard > Database > Backups

2. **ุงูุฃูุงู:**
   - ูุง ุชุดุงุฑู ููุงุชูุญ API ุงูุนุงูุฉ
   - ุงุณุชุฎุฏู Environment Variables
   - ูุนูู RLS ุนูู ุฌููุน ุงูุฌุฏุงูู

3. **ุงูุฃุฏุงุก:**
   - ุงุณุชุฎุฏู ุงูููุงุฑุณ ุจุญููุฉ
   - ุชุฌูุจ SELECT * ูู ุงูุงุณุชุนูุงูุงุช ุงููุจูุฑุฉ
   - ุงุณุชุฎุฏู LIMIT ูู ุงูุงุณุชุนูุงูุงุช

4. **ุงูุตูุงูุฉ:**
   - ุฑุงูุจ ุญุฌู ูุงุนุฏุฉ ุงูุจูุงูุงุช
   - ูุธู ุงูุจูุงูุงุช ุงููุฏููุฉ ุฏูุฑูุงู
   - ุญุฏูุซ ุงูุฅุญุตุงุฆูุงุช ุจุงูุชุธุงู

---

## ๐ฏ **ุงูุฎูุงุตุฉ:**

**Backend ุฌุงูุฒ ุจุงููุงูู ูุน:**
- โ 9 ุฌุฏุงูู ูุชูุงููุฉ
- โ RLS ููุฃูุงู
- โ Triggers ุชููุงุฆูุฉ
- โ Functions ูุณุงุนุฏุฉ
- โ ุจูุงูุงุช ุชุฌุฑูุจูุฉ
- โ ุงุณุชุนูุงูุงุช ุฌุงูุฒุฉ
- โ ุฏููู ุดุงูู

**๐ ุฌุงูุฒ ููุงุณุชุฎุฏุงู ุงูููุฑู!**
